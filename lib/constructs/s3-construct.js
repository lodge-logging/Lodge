const cdk = require('@aws-cdk/core');
const s3 = require('@aws-cdk/aws-s3');

class s3 extends cdk.Construct {
  constructor(scope, id, props) {
    super(scope, id, props);

    const s3Bucket = new s3.Bucket(this, 's3-bucket', {
      // bucketName - will be auto generated by CF
      removalpolicy: cdk.RemovalPolicy.DESTROY, // destroy bucket when stack deleted
      autoDeleteObjects: true, // empty bucket content when stack deleted
      versioned: false, 
      publicReadAccess: false, // no public access for READ
      encryption: s3.BucketEncryption.S3_MANAGED, // server side encryption
      lifecycleRules: [{
        transitions: s3.StorageClass.INFREQUENT_ACCESS, // move to IA after 30 days
        transitionAfter: cdk.Duration.days(30),
      }]
    });
  } 
}

module.exports = { s3 };
